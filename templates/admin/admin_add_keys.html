<!-- templates/admin/admin_add_keys.html -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Key Yönetimi</title>
    <link rel="stylesheet" href="/static/admin.css">
    <link href="https://fonts.googleapis.com/css2?family=Fjalla+One&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #121212;
            color: #fff;
            font-family: 'Fjalla One', sans-serif;
            padding: 30px;
        }
        h1, h2 {
            border-bottom: 1px solid #444;
            padding-bottom: 5px;
        }
        input, select, button  {
            padding: 10px;
            
            margin: 5px;
            background: #1e1e1e;
            color: #fff;
            border: 1px solid #555;
            border-radius: 50px;

            
      
            
        }
        .platform-section {
            margin-bottom: 40px;
            border: 1px solid #555;
            padding: 20px;
            border-radius: 10px;
        }
        ul {
            list-style: none;
            padding-left: 0;
        }
        .update-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 5px 10px;
            margin-left: 10px;
            cursor: pointer;
        }
        .delete-btn {
            background-color: #e53935;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 5px 10px;
            margin-left: 10px;
            cursor: pointer;
        }
        
    </style>
</head>
<body>

    <h1>-----> Key Yönetimi</h1>

    <!-- Key Ekleme Formu -->
    <form method="POST">
        <select name="platform" required>
            <option value="">Platform Seç</option>
            {% for plat in keys.keys() %}
                <option value="{{ plat }}">{{ plat|upper }}</option>
            {% endfor %}
        </select>
        <input type="text" name="new_key" placeholder="Yeni Key" required>
        <input type="number" name="usage" min="1" value="" placeholder="Kullanım Hakkı">
        <button type="submit">Ekle</button>
    </form>

    <hr>

    <!-- Key Listeleri -->
    {% for plat, keylist in keys.items() %}
    <div class="platform-section">
        <h2>{{ plat|upper }} Aktif Keyler</h2>
        {% if keylist %}
        <ul>
            {% for k, count in keylist.items() %}
                <li>
                    {{ k }} | Kullanım: 
                    <input type="number" id="usage-{{ plat }}-{{ loop.index }}" value="{{ count }}" min="1" style="width: 60px;">
                    <button class="update-btn" onclick="updateKey('{{ plat }}', '{{ k }}', 'usage-{{ plat }}-{{ loop.index }}')">Güncelle</button>
                    <button class="delete-btn" onclick="deleteKey('{{ plat }}', '{{ k }}')">Sil</button>
                </li>
            {% endfor %}
        </ul>
        {% else %}
            <p>Aktif key yok.</p>
        {% endif %}
    </div>
    {% endfor %}

    <footer style="position: fixed; bottom: 10px; width: 100%; text-align: center;">
        <a href="https://www.itemsatis.com/profil/rosewfshop.html" target="_blank" style="color: white; font-size: 14px; text-decoration: underline;">
          RosewfSoftware ™ 2025 Tüm Hakları Saklıdır
        </a>
    </footer>

    <!-- Yan Menü Butonu -->
    <div class="menu-toggle" onclick="toggleSidebar()">☰</div>

    <!-- Yandan Açılan Menü -->
    <div class="sidebar" id="sidebar">
        <ul>
            <li><a href="/admin/panel">Ana Sayfa</a></li>
            <li><a href="/admin/add-accounts">Hesap Ekle</a></li>
            <li><a href="/admin/add-keys">Key Ekle</a></li>
            <li><a href="/admin/logs">Son Alınan Kodlar</a></li>
        </ul>
    </div>

    <script>
        function toggleSidebar() {
            document.getElementById("sidebar").classList.toggle("active");
        }

        function deleteKey(platform, key) {
            fetch("/admin/delete-key", {
                method: "POST",
                headers: {"Content-Type": "application/x-www-form-urlencoded"},
                body: `platform=${platform}&key=${key}`
            }).then(res => res.json())
            .then(data => {
                if (data.success) location.reload();
                else alert("Silinemedi");
            });
        }

        function updateKey(platform, key, inputId) {
            const usage = document.getElementById(inputId).value;
            fetch("/admin/update-key", {
                method: "POST",
                headers: {"Content-Type": "application/x-www-form-urlencoded"},
                body: `platform=${platform}&key=${key}&usage=${usage}`
            }).then(res => res.json())
            .then(data => {
                if (data.success) location.reload();
                else alert("Güncellenemedi");
            });
        }
    </script>

</body>
</html>